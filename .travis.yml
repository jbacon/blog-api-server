language: bash
sudo: required
dist: trusty
services:
  - docker
git:
  depth: 1
  submodules: false
branches:
  only:
  - master
# cache:
#   directories:
#     - "node_modules"
env:
  global:
    NODE_ENV='production'
# addons:
#   ssh_known_hosts: portfolioapi.joshbacon.name
#   ssh_known_hosts: portfolio.joshbacon.name
before_install:
  - source ./scripts/env.sh
install:
  - bash ./scripts/install.sh
before_script:
  - bash ./scripts/lint.sh
script:
  - bash ./scripts/test.sh
  - bash ./scripts/build.sh
after_script:
  - echo "After Script..."
before_cache:
  - echo "Before Cache..."
after_success:
  - echo "After Success..."
after_failure:
  - echo "After Failure..."
before_deploy:
  - echo "Before Deploy..."
deploy:
  provider: script
  script: if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/publish.sh; fi'
  on:
    branch: master
  skip_cleanup: true
after_deploy:
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/mongo.sh; fi'
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/rollout.sh; fi'